#!/usr/bin/env bash
#
# Exports $DOTFILES_PATH.

########################################
# Emulates GNU readlink -f option.
########################################
readlink() {
  if [ $# -eq 0 ]; then
    return 1
  fi

  local file phys default

  # Change directory and reset file.
  file="$1"
  cd "$(dirname "$file")"
  file="$(basename "$file")"

  # Readlink recursively.
  while [ -L "$file" ]; do
    file="$(command readlink "$file")"
    cd "$(dirname "$file")"
    file="$(basename "$file")"
  done

  # Get read pwd.
  phys="$(pwd -P)"
  result="$phys/$file"

  # Returns result
  echo "$result"
}

dotfiles_path="$(dirname "$(dirname "$(readlink "${BASH_SOURCE:-$0}")")")"

if echo "$-" | grep -q "i"; then
  # $ source .path
  DOTFILES_PATH="$dotfiles_path"
  export DOTFILES_PATH
else
  if [ "$0" = "${BASH_SOURCE:-}" ]; then
    # $ bash .path
    echo "$dotfiles_path"
  fi
fi
